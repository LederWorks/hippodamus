version: "1.0"
metadata:
  title: "Azure DevOps Organization Structure"
  description: "Complex Azure DevOps organization with projects, repositories, pipelines, and services"
  author: "Hippodamus Azure DevOps Schema"
  tags: ["azure-devops", "cicd", "organization", "nested-structure"]

templates:
  - name: "azuredevops-organization"
    template: "azuredevops/azuredevops-organization.yaml"
  - name: "azuredevops-project"
    template: "azuredevops/azuredevops-project.yaml"
  - name: "azuredevops-repository"
    template: "azuredevops-repository.yaml"
  - name: "azuredevops-pipeline"
    template: "azuredevops-pipeline.yaml"
  - name: "azuredevops-service-connection"
    template: "azuredevops-service-connection.yaml"
  - name: "azuredevops-environment"
    template: "azuredevops-environment.yaml"
  - name: "azuredevops-library"
    template: "azuredevops-library.yaml"
  - name: "azuredevops-resources"
    template: "azuredevops-resources.yaml"

diagram:
  properties:
    grid:
      enabled: true
      size: 20
    background:
      color: "#fafafa"
    scale: 1.0

  pages:
    - id: "organization-overview"
      name: "Azure DevOps Organization"
      properties:
        width: 1600
        height: 1200
        background: "#ffffff"

      elements:
        - type: "container"
          id: "contoso-org"
          template: "azuredevops-organization"
          properties:
            x: 20
            y: 20
            custom:
              orgName: "ado-org"
          nesting:
            mode: "container"
            autoResize: true
            padding:
              top: 50
              right: 30
              bottom: 30
              left: 30
            spacing: 40
            arrangement: "vertical"
          children:
            # Project 1: Web Application
            - type: "container"
              id: "webapp-project"
              template: "azuredevops-project"
              properties:
                x: 0  # Will be auto-positioned by nesting
                y: 0
                custom:
                  projectName: "WebApp Frontend"
                  projectType: "Agile"
              nesting:
                mode: "container"
                autoResize: true
                padding:
                  top: 40
                  right: 20
                  bottom: 20
                  left: 20
                spacing: 15
                arrangement: "grid"
              children:
                # Repositories with integrated pipelines and service connections
                - type: "group"
                  id: "webapp-repo"
                  template: "azuredevops-repository"
                  properties:
                    x: 0
                    y: 0
                    width: 660
                    height: 80
                    custom:
                      repoName: "frontend-react"
                      repoType: "Git"
                      hasPipeline: true
                      hasServiceConnection: true

                - type: "group"
                  id: "webapp-api-repo"
                  template: "azuredevops-repository"
                  properties:
                    x: 0
                    y: 0
                    width: 660
                    height: 80
                    custom:
                      repoName: "backend-api"
                      repoType: "Git"
                      hasPipeline: true
                      hasServiceConnection: true

                # Pipelines
                - type: "shape"
                  id: "webapp-ci-pipeline"
                  template: "azuredevops-pipeline"
                  properties:
                    x: 0
                    y: 0
                    custom:
                      pipelineName: "Frontend CI"
                      pipelineType: "YAML"

                - type: "shape"
                  id: "webapp-cd-pipeline"
                  template: "azuredevops-pipeline"
                  properties:
                    x: 0
                    y: 0
                    custom:
                      pipelineName: "Frontend CD"
                      pipelineType: "Release"

                # Service Connections
                - type: "shape"
                  id: "azure-subscription"
                  template: "azuredevops-service-connection"
                  properties:
                    x: 0
                    y: 0
                    custom:
                      connectionName: "Azure Production"
                      connectionType: "Azure Resource Manager"

                # Environments
                - type: "shape"
                  id: "dev-environment"
                  template: "azuredevops-environment"
                  properties:
                    x: 0
                    y: 0
                    custom:
                      environmentName: "Development"
                      environmentType: "Development"

                - type: "shape"
                  id: "prod-environment"
                  template: "azuredevops-environment"
                  properties:
                    x: 0
                    y: 0
                    custom:
                      environmentName: "Production"
                      environmentType: "Production"

                # Library Items
                - type: "shape"
                  id: "webapp-variables"
                  template: "azuredevops-library"
                  properties:
                    x: 0
                    y: 0
                    custom:
                      libraryName: "WebApp Variables"
                      libraryType: "Variable Group"

            # Project 2: Microservices
            - type: "container"
              id: "microservices-project"
              template: "azuredevops-project"
              properties:
                x: 0
                y: 0
                custom:
                  projectName: "Microservices Platform"
                  projectType: "Scrum"
              nesting:
                mode: "container"
                autoResize: true
                padding:
                  top: 40
                  right: 20
                  bottom: 20
                  left: 20
                spacing: 15
                arrangement: "grid"
              children:
                # Multiple Microservice Repositories
                - type: "shape"
                  id: "user-service-repo"
                  template: "azuredevops-repository"
                  properties:
                    x: 0
                    y: 0
                    custom:
                      repoName: "user-service"
                      repoType: "Git"

                - type: "shape"
                  id: "order-service-repo"
                  template: "azuredevops-repository"
                  properties:
                    x: 0
                    y: 0
                    custom:
                      repoName: "order-service"
                      repoType: "Git"

                - type: "shape"
                  id: "payment-service-repo"
                  template: "azuredevops-repository"
                  properties:
                    x: 0
                    y: 0
                    custom:
                      repoName: "payment-service"
                      repoType: "Git"

                # Microservices Pipelines
                - type: "shape"
                  id: "microservices-ci"
                  template: "azuredevops-pipeline"
                  properties:
                    x: 0
                    y: 0
                    custom:
                      pipelineName: "Microservices CI"
                      pipelineType: "YAML"

                - type: "shape"
                  id: "kubernetes-deploy"
                  template: "azuredevops-pipeline"
                  properties:
                    x: 0
                    y: 0
                    custom:
                      pipelineName: "K8s Deployment"
                      pipelineType: "YAML"

                # Service Connections
                - type: "shape"
                  id: "k8s-connection"
                  template: "azuredevops-service-connection"
                  properties:
                    x: 0
                    y: 0
                    custom:
                      connectionName: "AKS Cluster"
                      connectionType: "Kubernetes"

                - type: "shape"
                  id: "acr-connection"
                  template: "azuredevops-service-connection"
                  properties:
                    x: 0
                    y: 0
                    custom:
                      connectionName: "Container Registry"
                      connectionType: "Docker Registry"

                # Environments
                - type: "shape"
                  id: "staging-environment"
                  template: "azuredevops-environment"
                  properties:
                    x: 0
                    y: 0
                    custom:
                      environmentName: "Staging"
                      environmentType: "Staging"

                - type: "shape"
                  id: "production-environment"
                  template: "azuredevops-environment"
                  properties:
                    x: 0
                    y: 0
                    custom:
                      environmentName: "Production"
                      environmentType: "Production"

                # Library Items
                - type: "shape"
                  id: "k8s-secrets"
                  template: "azuredevops-library"
                  properties:
                    x: 0
                    y: 0
                    custom:
                      libraryName: "K8s Secrets"
                      libraryType: "Secure Files"

                - type: "shape"
                  id: "microservices-vars"
                  template: "azuredevops-library"
                  properties:
                    x: 0
                    y: 0
                    custom:
                      libraryName: "Microservices Config"
                      libraryType: "Variable Group"

            # Project 3: Infrastructure
            - type: "container"
              id: "infrastructure-project"
              template: "azuredevops-project"
              properties:
                x: 0
                y: 0
                custom:
                  projectName: "Infrastructure as Code"
                  projectType: "Basic"
              nesting:
                mode: "container"
                autoResize: true
                padding:
                  top: 40
                  right: 20
                  bottom: 20
                  left: 20
                spacing: 15
                arrangement: "grid"
              children:
                # Infrastructure Repositories
                - type: "shape"
                  id: "terraform-repo"
                  template: "azuredevops-repository"
                  properties:
                    x: 0
                    y: 0
                    custom:
                      repoName: "terraform-modules"
                      repoType: "Git"

                - type: "shape"
                  id: "arm-templates-repo"
                  template: "azuredevops-repository"
                  properties:
                    x: 0
                    y: 0
                    custom:
                      repoName: "arm-templates"
                      repoType: "Git"

                # Infrastructure Pipelines
                - type: "shape"
                  id: "terraform-pipeline"
                  template: "azuredevops-pipeline"
                  properties:
                    x: 0
                    y: 0
                    custom:
                      pipelineName: "Terraform Deploy"
                      pipelineType: "YAML"

                - type: "shape"
                  id: "arm-pipeline"
                  template: "azuredevops-pipeline"
                  properties:
                    x: 0
                    y: 0
                    custom:
                      pipelineName: "ARM Templates"
                      pipelineType: "YAML"

                # Service Connections
                - type: "shape"
                  id: "subscription-mgmt"
                  template: "azuredevops-service-connection"
                  properties:
                    x: 0
                    y: 0
                    custom:
                      connectionName: "Subscription Management"
                      connectionType: "Azure Resource Manager"

                # Library Items
                - type: "shape"
                  id: "terraform-vars"
                  template: "azuredevops-library"
                  properties:
                    x: 0
                    y: 0
                    custom:
                      libraryName: "Terraform Variables"
                      libraryType: "Variable Group"

        # Add some connecting lines to show relationships
        - type: "connector"
          id: "org-to-webapp"
          properties:
            source: "contoso-org"
            target: "webapp-project"
            label: "contains"
          style:
            strokeColor: "#1976D2"
            strokeWidth: 2
            strokeDashArray: "5,5"

        - type: "connector"
          id: "webapp-ci-to-cd"
          properties:
            source: "webapp-ci-pipeline"
            target: "webapp-cd-pipeline"
            label: "triggers"
          style:
            strokeColor: "#7B1FA2"
            strokeWidth: 2

        - type: "connector"
          id: "microservices-to-k8s"
          properties:
            source: "microservices-ci"
            target: "kubernetes-deploy"
            label: "triggers"
          style:
            strokeColor: "#7B1FA2"
            strokeWidth: 2
